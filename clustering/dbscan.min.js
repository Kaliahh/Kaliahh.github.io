async function setup(){for(createCanvas(windowWidth,windowHeight),background(51),numberOfPoints=Math.floor(width/3),epsilon=getEpsilon(),MinPts=4;;)clusters=[],colors=getClusterColors(),unvisited=createPoints(numberOfPoints),visited=[],await dbscan(),await sleep(1e3)}function getEpsilon(){return Math.floor(205299e-10*Math.pow(width,2)+.0012174476*width+27.8965922976)}function draw(){background(51);for(let e=0;e<unvisited.length;e++)unvisited[e].color=color(255,255,255),unvisited[e].display();for(let e=0;e<visited.length;e++)visited[e].noise?visited[e].color=color(100):visited[e].color=color(0,255,0),visited[e].display();for(let e=0;e<clusters.length;e++)for(let i=0;i<clusters[e].length;i++)null==colors[e]&&(colors[e]=randomColor()),clusters[e][i].color=colors[e],clusters[e][i].display(),clusters[e][i].displayNeighborhood(epsilon)}async function dbscan(){for(;unvisited.length>0;){let e=unvisited.pop();e.visited=!0,visited.push(e);let i=getNeighborhood(e);if(i.length>=MinPts){e.corePoint=!0;let t=[];clusters.push(t),t.push(e),await scanNeighborhood(i,t)}else e.noise=!0}}async function scanNeighborhood(e,i){for(;e.length>0;){await sleep(20);let t=getNeighbor(e.pop());if(0==t.visited){t.visited=!0,visited.push(t);let i=getNeighborhood(t);i.length>=MinPts&&(t.corePoint=!0,scanOtherNeighborhood(e,i))}isNotInCluster(t)&&i.push(t)}}function scanOtherNeighborhood(e,i){for(let t=0;t<i.length;t++)e.push(i[t])}function getNeighbor(e){let i=null;return unvisited.includes(e)?(index=unvisited.indexOf(e),i=unvisited.splice(index,1)[0]):visited.includes(e)?(index=visited.indexOf(e),i=visited[index]):console.log("This should not happen"),i}function isNotInCluster(e){for(let i=0;i<clusters.length;i++)if(clusters[i].includes(e))return!1;return!0}function getNeighborhood(e){let i=[];for(let t=0;t<unvisited.length;t++)distanceBetweenTwoPoints(e,unvisited[t])<=epsilon&&i.push(unvisited[t]);for(let t=0;t<visited.length;t++)distanceBetweenTwoPoints(e,visited[t])<=epsilon&&i.push(visited[t]);return i}